window.onload=function(){  
  // Обзываем блоки как витруальные страницы 
    // 1 - ID веб-тега, например блока DIV
    // 2 - Передаваемый в метрику URL страницы
    // 3 - Передаваемое в метрику Название страницы - title

 	var hitLinks= [
	  //Страница по умолчанию
	  ["section-home","/","Главная"],
	  //Остальные блоки как виртуальные страницы
	  ["section-health-life","/section-health-life","ЗОЖ"],
	  ["section-format","/section-format","Формат"],
	  ["section-marafon","/section-marafon","Марафон"],
	  ["section-for-who","/section-for-who","Для кого"],
  ];
                
	//    global_ch - высота окна браузера             
	var global_ch=document.body.clientHeight;
	var global_wh=document.body.scrollHeight;
	var global_currentBlock = 0;
	var global_refererBlock = 0;

	//Добавляем в архив с блоками отступы самих блоков
	hitLinks.forEach(function(value,i,arr) {
	 var linkId=arr[i][0];
	  hitLinks[i][3]=getElementPosition(linkId).top;
	  hitLinks[i][4]=getElementPosition(linkId).top+getElementPosition(linkId).height;
	});

	//получаем отступ блока от вверха и его высоту по ID блока
	function getElementPosition(elemId){
	   var elem = document.getElementById(elemId);
	   var h = elem.offsetHeight;
	   var t = 0;
	   while (elem)
	   {
	     t += elem.offsetTop;
	     elem = elem.offsetParent;
	   }
	   return  {"top":t, "height":h};
	} 

 	//Сравниваем значение скрола со всеми элементами
 	window.onscroll = function() {
    var scrolled = window.pageYOffset || document.documentElement.scrollTop;
    hitLinks.forEach(function(value,i,arr) {
    // viewLine - линия, по которой определяем, в каком блоке сейчас ноходимся, по умолчанию 25% (1/4) от верха 
    var viewLine = scrolled+global_ch/4;
    if (viewLine >= arr[i][3] && viewLine < arr[i][4]){
      if (i!==global_currentBlock) {
         global_refererBlock=global_currentBlock;
         global_currentBlock=i; 
        //Для отладки
        console.log(hitLinks);
        console.log ("yaCounterXXXXXX.hit("+hitLinks[global_currentBlock][1] +","+ hitLinks[global_currentBlock][2]  +","+hitLinks[global_refererBlock][1] +")");
        //.hit(url, [title], [referer], [params])
        //
        //ga('send', 'pageview', { 'page': hitLinks[global_currentBlock][1] ,  'title': hitLinks[global_currentBlock][2]});
      }
    }
    }); 
	};
};